/** @license sf2.js 2013 - imaya The MIT License */(function() {'use strict';function h(c){throw c;}var r=void 0,aa=!0,ba=null,t=!1,y=this;function ga(c,a){var b=c.split("."),d=y;!(b[0]in d)&&d.execScript&&d.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)!b.length&&a!==r?d[e]=a:d=d[e]?d[e]:d[e]={}};function ha(c,a,b){this.ctx=c;this.destination=a;this.instrument=b;this.channel=b.channel;this.key=b.key;this.velocity=b.velocity;this.buffer=b.sample;this.playbackRate=b.basePlaybackRate;this.sampleRate=b.sampleRate;this.volume=b.volume;this.panpot=b.panpot;this.pitchBend=b.pitchBend;this.pitchBendSensitivity=b.pitchBendSensitivity;this.modEnvToPitch=b.modEnvToPitch}
ha.prototype.noteOn=function(){var c=this.ctx,a=this.instrument,b=this.buffer,d,e,g,f,k,s=this.ctx.currentTime,p=s+a.volAttack,x=s+a.modAttack,A=p+a.volDecay,I=a.loopStart/this.sampleRate,O=a.loopEnd/this.sampleRate,J=a.start/this.sampleRate,b=b.subarray(0,b.length+a.end);d=this.audioBuffer=c.createBuffer(1,b.length,this.sampleRate);d.getChannelData(0).set(b);e=this.bufferSource=c.createBufferSource();e.buffer=d;e.loop=9!==this.channel;e.loopStart=I;e.loopEnd=O;ia(this,this.pitchBend,aa);g=this.panner=
c.createPanner();f=this.gainOutput=c.createGainNode();k=f.gain;g.panningModel=0;g.setPosition(Math.sin(this.panpot*Math.PI/2),0,Math.cos(this.panpot*Math.PI/2));k.setValueAtTime(0,s);k.linearRampToValueAtTime(this.volume*2*(this.velocity/127),p);k.linearRampToValueAtTime(this.volume*(1-a.volSustain),A);this.bufferSource.playbackRate.setValueAtTime(this.basePlaybackRate,s);this.bufferSource.playbackRate.linearRampToValueAtTime(this.playbackRate*Math.pow(Math.pow(2,1/12),(this.pitchBendSensitivity*
(this.pitchBend/(0>this.pitchBend?8192:8191))+this.modEnvToPitch)*this.instrument.scaleTuning),x);e.connect(g);g.connect(f);f.connect(this.destination);e.start(0,J)};
ha.prototype.noteOff=function(){var c=this.instrument,a=this.bufferSource,b=this.gainOutput,d=this.ctx.currentTime+c.volRelease;this.audioBuffer&&(b.gain.cancelScheduledValues(0),b.gain.linearRampToValueAtTime(0,d),a.loop=t,a.stop(d),setTimeout(function(a){return function(){a.bufferSource.disconnect(0);a.panner.disconnect(0);a.gainOutput.disconnect(0)}}(this),1E3*c.volRelease))};
function ia(c,a,b){c.bufferSource.playbackRate.cancelScheduledValues(0);c.bufferSource.playbackRate.setValueAtTime(c.playbackRate*Math.pow(Math.pow(2,1/12),(c.pitchBendSensitivity*(a/(0>a?8192:8191))+(b?0:c.modEnvToPitch))*c.instrument.scaleTuning),0)};function Ca(c,a){a=a||{};this.input=c;this.ip=a.index||0;this.length=a.length||c.length-this.ip;this.offset=this.ip;this.padding=a.padding!==r?a.padding:aa;this.bigEndian=a.bigEndian!==r?a.bigEndian:t}function Da(c,a,b){this.type=c;this.size=a;this.offset=b}
Ca.prototype.parse=function(){var c=this.length+this.offset;for(this.chunkList=[];this.ip<c;){var a=this.input,b=this.ip,d=r;this.chunkList.push(new Da(String.fromCharCode(a[b++],a[b++],a[b++],a[b++]),d=this.bigEndian?(a[b++]<<24|a[b++]<<16|a[b++]<<8|a[b++])>>>0:(a[b++]|a[b++]<<8|a[b++]<<16|a[b++]<<24)>>>0,b));b+=d;this.padding&&1===(b-this.offset&1)&&b++;this.ip=b}};function E(c,a){var b=c.chunkList[a];return b===r?ba:b};function Ea(c,a){a=a||{};this.input=c;this.parserOption=a.parserOption}
Ea.prototype.parse=function(){var c,a,b=new Ca(this.input,this.parserOption),d;b.parse();1!==b.chunkList.length&&h(Error("wrong chunk length"));d=E(b,0);d===ba&&h(Error("chunk not found"));var e,g=this.input,f=d.offset,k;"RIFF"!==d.type&&h(Error("invalid chunk type:"+d.type));k=String.fromCharCode(g[f++],g[f++],g[f++],g[f++]);"sfbk"!==k&&h(Error("invalid signature:"+k));e=new Ca(g,{index:f,length:d.size-4});e.parse();3!==e.chunkList.length&&h(Error("invalid sfbk structure"));var s=E(e,0),p=this.input,
x=s.offset,A;"LIST"!==s.type&&h(Error("invalid chunk type:"+s.type));A=String.fromCharCode(p[x++],p[x++],p[x++],p[x++]);"INFO"!==A&&h(Error("invalid signature:"+A));(new Ca(p,{index:x,length:s.size-4})).parse();var I=E(e,1),O,J=this.input,P=I.offset,ja;"LIST"!==I.type&&h(Error("invalid chunk type:"+I.type));ja=String.fromCharCode(J[P++],J[P++],J[P++],J[P++]);"sdta"!==ja&&h(Error("invalid signature:"+ja));O=new Ca(J,{index:P,length:I.size-4});O.parse();1!==O.chunkList.length&&h(Error("TODO"));this.samplingData=
E(O,0);var B=E(e,2),v,w=this.input,W=B.offset,ka;"LIST"!==B.type&&h(Error("invalid chunk type:"+B.type));ka=String.fromCharCode(w[W++],w[W++],w[W++],w[W++]);"pdta"!==ka&&h(Error("invalid signature:"+ka));v=new Ca(w,{index:W,length:B.size-4});v.parse();9!==v.chunkList.length&&h(Error("invalid pdta chunk"));var X=E(v,0),u=this.input,q=X.offset,va=this.presetHeader=[],wa=X.offset+X.size;"phdr"!==X.type&&h(Error("invalid chunk type:"+X.type));for(;q<wa;)va.push({presetName:String.fromCharCode.apply(ba,
u.subarray(q,q+=20)),preset:u[q++]|u[q++]<<8,bank:u[q++]|u[q++]<<8,presetBagIndex:u[q++]|u[q++]<<8,library:(u[q++]|u[q++]<<8|u[q++]<<16|u[q++]<<24)>>>0,genre:(u[q++]|u[q++]<<8|u[q++]<<16|u[q++]<<24)>>>0,morphology:(u[q++]|u[q++]<<8|u[q++]<<16|u[q++]<<24)>>>0});var F=E(v,1),D=this.input,Y=F.offset,xa=this.presetZone=[],ya=F.offset+F.size;"pbag"!==F.type&&h(Error("invalid chunk type:"+F.type));for(;Y<ya;)xa.push({presetGeneratorIndex:D[Y++]|D[Y++]<<8,presetModulatorIndex:D[Y++]|D[Y++]<<8});var ca=E(v,
2);"pmod"!==ca.type&&h(Error("invalid chunk type:"+ca.type));this.presetZoneModulator=Fa(this,ca);var G=E(v,3);"pgen"!==G.type&&h(Error("invalid chunk type:"+G.type));this.presetZoneGenerator=Ia(this,G);var Z=E(v,4),C=this.input,Q=Z.offset,za=this.instrument=[],Aa=Z.offset+Z.size;"inst"!==Z.type&&h(Error("invalid chunk type:"+Z.type));for(;Q<Aa;)za.push({instrumentName:String.fromCharCode.apply(ba,C.subarray(Q,Q+=20)),instrumentBagIndex:C[Q++]|C[Q++]<<8});var K=E(v,5),R=this.input,z=K.offset,la=this.instrumentZone=
[],ma=K.offset+K.size;"ibag"!==K.type&&h(Error("invalid chunk type:"+K.type));for(;z<ma;)la.push({instrumentGeneratorIndex:R[z++]|R[z++]<<8,instrumentModulatorIndex:R[z++]|R[z++]<<8});var $=E(v,6);"imod"!==$.type&&h(Error("invalid chunk type:"+$.type));this.instrumentZoneModulator=Fa(this,$);var na=E(v,7);"igen"!==na.type&&h(Error("invalid chunk type:"+na.type));this.instrumentZoneGenerator=Ia(this,na);var L=E(v,8),m=this.input,l=L.offset,Ba=this.sample=[],n=this.sampleHeader=[],oa=L.offset+L.size,
S,da,pa,T,U,V,qa,ra,sa,ta;"shdr"!==L.type&&h(Error("invalid chunk type:"+L.type));for(;l<oa;){S=String.fromCharCode.apply(ba,m.subarray(l,l+=20));da=(m[l++]<<0|m[l++]<<8|m[l++]<<16|m[l++]<<24)>>>0;pa=(m[l++]<<0|m[l++]<<8|m[l++]<<16|m[l++]<<24)>>>0;T=(m[l++]<<0|m[l++]<<8|m[l++]<<16|m[l++]<<24)>>>0;U=(m[l++]<<0|m[l++]<<8|m[l++]<<16|m[l++]<<24)>>>0;V=(m[l++]<<0|m[l++]<<8|m[l++]<<16|m[l++]<<24)>>>0;qa=m[l++];ra=m[l++]<<24>>24;sa=m[l++]|m[l++]<<8;ta=m[l++]|m[l++]<<8;var ea=new Int16Array((new Uint8Array(m.subarray(this.samplingData.offset+
2*da,this.samplingData.offset+2*pa))).buffer);T-=da;U-=da;if(0<V){for(var M=ea,N=V,fa=r,ua=r,Na=r,Ga=r,Ha=1;22050>N;){fa=new Int16Array(2*M.length);ua=Ga=0;for(Na=M.length;ua<Na;++ua)fa[Ga++]=M[ua],fa[Ga++]=M[ua];M=fa;Ha*=2;N*=2}c=M;a=Ha;ea=c;V*=a;T*=a;U*=a}Ba.push(ea);n.push({sampleName:S,startLoop:T,endLoop:U,sampleRate:V,originalPitch:qa,pitchCorrection:ra,sampleLink:sa,sampleType:ta})}this.input=ba};
function Fa(c,a){for(var b=c.input,d=a.offset,e=a.offset+a.size,g,f,k=[];d<e;){d+=2;g=b[d++]|b[d++]<<8;f=Ja[g];if(f===r)k.push({type:f,value:{code:g,amount:b[d]|b[d+1]<<8<<16>>16,lo:b[d++],hi:b[d++]}});else switch(f){case "keyRange":case "velRange":case "keynum":case "velocity":k.push({type:f,value:{lo:b[d++],hi:b[d++]}});break;default:k.push({type:f,value:{amount:b[d++]|b[d++]<<8<<16>>16}})}d+=2;d+=2}return k}
function Ia(c,a){for(var b=c.input,d=a.offset,e=a.offset+a.size,g,f,k=[];d<e;)if(g=b[d++]|b[d++]<<8,f=Ja[g],f===r)k.push({type:f,value:{code:g,amount:b[d]|b[d+1]<<8<<16>>16,lo:b[d++],hi:b[d++]}});else switch(f){case "keynum":case "keyRange":case "velRange":case "velocity":k.push({type:f,value:{lo:b[d++],hi:b[d++]}});break;default:k.push({type:f,value:{amount:b[d++]|b[d++]<<8<<16>>16}})}return k}
function Ka(c,a,b){var d=[],e={unknown:[],keyRange:{hi:127,lo:0}},g,f;for(f=c;f<a;++f)g=b[f],d.push(g),"unknown"===g.type?e.unknown.push(g.value):e[g.type]=g.value;return{modgen:e,modgenInfo:d}}
var Ja=["startAddrsOffset","endAddrsOffset","startloopAddrsOffset","endloopAddrsOffset","startAddrsCoarseOffset","modLfoToPitch","vibLfoToPitch","modEnvToPitch","initialFilterFc","initialFilterQ","modLfoToFilterFc","modEnvToFilterFc","endAddrsCoarseOffset","modLfoToVolume",,"chorusEffectsSend","reverbEffectsSend","pan",,,,"delayModLFO","freqModLFO","delayVibLFO","freqVibLFO","delayModEnv","attackModEnv","holdModEnv","decayModEnv","sustainModEnv","releaseModEnv","keynumToModEnvHold","keynumToModEnvDecay",
"delayVolEnv","attackVolEnv","holdVolEnv","decayVolEnv","sustainVolEnv","releaseVolEnv","keynumToVolEnvHold","keynumToVolEnvDecay","instrument",,"keyRange","velRange","startloopAddrsCoarseOffset","keynum","velocity","initialAttenuation",,"endloopAddrsCoarseOffset","coarseTune","fineTune","sampleID","sampleModes",,"scaleTuning","exclusiveClass","overridingRootKey"];function La(c){this.input=c;this.bank=0;this.bufferSize=1024;var a;y.AudioContext!==r?a=new y.AudioContext:y.webkitAudioContext!==r?a=new y.webkitAudioContext:y.mozAudioContext!==r?a=new y.mozAudioContext:h(Error("Web Audio not supported"));a.createGainNode===r&&(a.createGainNode=a.createGain);this.ctx=a;this.gainMaster=this.ctx.createGainNode();this.compressor=this.ctx.createDynamicsCompressor();this.bufSrc=this.ctx.createBufferSource();this.channelInstrument=[0,1,2,3,4,5,6,7,8,0,10,11,12,13,14,
15];this.channelVolume=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];this.channelPanpot=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.channelPitchBend=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.channelPitchBendSensitivity=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.currentNoteOn=[[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]];this.baseVolume=1/32768;this.masterVolume=16384}var Ma="Acoustic Piano;Bright Piano;Electric Grand Piano;Honky-tonk Piano;Electric Piano;Electric Piano 2;Harpsichord;Clavi;Celesta;Glockenspiel;Musical box;Vibraphone;Marimba;Xylophone;Tubular Bell;Dulcimer;Drawbar Organ;Percussive Organ;Rock Organ;Church organ;Reed organ;Accordion;Harmonica;Tango Accordion;Acoustic Guitar (nylon);Acoustic Guitar (steel);Electric Guitar (jazz);Electric Guitar (clean);Electric Guitar (muted);Overdriven Guitar;Distortion Guitar;Guitar harmonics;Acoustic Bass;Electric Bass (finger);Electric Bass (pick);Fretless Bass;Slap Bass 1;Slap Bass 2;Synth Bass 1;Synth Bass 2;Violin;Viola;Cello;Double bass;Tremolo Strings;Pizzicato Strings;Orchestral Harp;Timpani;String Ensemble 1;String Ensemble 2;Synth Strings 1;Synth Strings 2;Voice Aahs;Voice Oohs;Synth Voice;Orchestra Hit;Trumpet;Trombone;Tuba;Muted Trumpet;French horn;Brass Section;Synth Brass 1;Synth Brass 2;Soprano Sax;Alto Sax;Tenor Sax;Baritone Sax;Oboe;English Horn;Bassoon;Clarinet;Piccolo;Flute;Recorder;Pan Flute;Blown Bottle;Shakuhachi;Whistle;Ocarina;Lead 1 (square);Lead 2 (sawtooth);Lead 3 (calliope);Lead 4 (chiff);Lead 5 (charang);Lead 6 (voice);Lead 7 (fifths);Lead 8 (bass + lead);Pad 1 (Fantasia);Pad 2 (warm);Pad 3 (polysynth);Pad 4 (choir);Pad 5 (bowed);Pad 6 (metallic);Pad 7 (halo);Pad 8 (sweep);FX 1 (rain);FX 2 (soundtrack);FX 3 (crystal);FX 4 (atmosphere);FX 5 (brightness);FX 6 (goblins);FX 7 (echoes);FX 8 (sci-fi);Sitar;Banjo;Shamisen;Koto;Kalimba;Bagpipe;Fiddle;Shanai;Tinkle Bell;Agogo;Steel Drums;Woodblock;Taiko Drum;Melodic Tom;Synth Drum;Reverse Cymbal;Guitar Fret Noise;Breath Noise;Seashore;Bird Tweet;Telephone Ring;Helicopter;Applause;Gunshot".split(";");
function H(c,a,b){b===r&&(b=0);return c[a]?c[a].amount:b}La.prototype.start=function(){this.bufSrc.connect(this.gainMaster);this.gainMaster.connect(this.ctx.destination);this.bufSrc.start(0);this.masterVolume=16383;this.gainMaster.gain.value=this.baseVolume*(16383/16384)};La.prototype.stop=function(){this.bufSrc.disconnect(0);this.gainMaster.disconnect(0);this.compressor.disconnect(0)};var Oa=["Instrument","Vol","Pan","Bend","Range"];
function Pa(c){var a=c.table=document.createElement("table"),b=document.createElement("thead"),d=document.createElement("tbody"),e,g,f,k;b.appendChild(Qa(Oa,aa));for(f=0;16>f;++f){e=Qa(Oa.length+128,t);d.appendChild(e);if(9!==f){var s=document.createElement("select"),p;for(k=0;128>k;++k)p=document.createElement("option"),p.textContent=Ma[k],s.appendChild(p);e.querySelector("td:nth-child(1)").appendChild(s);s.addEventListener("change",function(a,b){return function(c){Ra(a,b,c.target.selectedIndex)}}(c,
f),t)}g=e.querySelectorAll("td:nth-last-child(-n+128)");for(k=0;128>k;++k)g[k].addEventListener("mousedown",function(a,b,c){return function(d){d.preventDefault();a.drag=aa;a.noteOn(b,c,127)}}(c,f,k)),g[k].addEventListener("mouseover",function(a,b,c){return function(d){d.preventDefault();a.drag&&a.noteOn(b,c,127)}}(c,f,k)),g[k].addEventListener("mouseout",function(a,b,c){return function(d){d.preventDefault();a.noteOff(b,c,0)}}(c,f,k)),g[k].addEventListener("mouseup",function(a,b,c){return function(d){d.preventDefault();
a.drag=t;a.noteOff(b,c,0)}}(c,f,k))}a.appendChild(b);a.appendChild(d);return a}function Qa(c,a){var b=document.createElement("tr"),d,e=c instanceof Array,g,f=e?c.length:c;for(g=0;g<f;++g)d=document.createElement(a?"th":"td"),d.textContent=e&&c[g]!==r?c[g]:"",b.appendChild(d);return b}
La.prototype.noteOn=function(c,a,b){var d=this.bankSet[9===c?128:this.bank][this.channelInstrument[c]],e,g;this.table&&this.table.querySelector("tbody > tr:nth-child("+(c+1)+") > td:nth-child("+(Oa.length+a+1)+")").classList.add("note-on");d?(e=d[a])?(e.channel=c,e.key=a,e.velocity=b,e.panpot=this.channelPanpot[c],e.volume=this.channelVolume[c],e.pitchBend=this.channelPitchBend[c],e.pitchBendSensitivity=this.channelPitchBendSensitivity[c],g=new ha(this.ctx,this.gainMaster,e),g.noteOn(),this.currentNoteOn[c].push(g)):
y.console.warn("instrument not found: bank=%s instrument=%s channel=%s key=%s",9===c?128:this.bank,this.channelInstrument[c],c,a):y.console.warn("instrument not found: bank=%s instrument=%s channel=%s",9===c?128:this.bank,this.channelInstrument[c],c)};
La.prototype.noteOff=function(c,a){var b=this.bankSet[9===c?128:this.bank][this.channelInstrument[c]],d,e,g=this.currentNoteOn[c],f;this.table&&this.table.querySelector("tbody > tr:nth-child("+(c+1)+") > td:nth-child("+(a+Oa.length+1)+")").classList.remove("note-on");if(b){d=0;for(e=g.length;d<e;++d)f=g[d],f.key===a&&(f.noteOff(),g.splice(d,1),--d,--e)}};
function Ra(c,a,b){c.table&&(9===a?c.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:first-child").textContent="[ RHYTHM TRACK ]":c.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:first-child > select").selectedIndex=b);9!==a&&(c.channelInstrument[a]=b)}function Sa(c,a,b){c.table&&(c.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child(2)").textContent=b);c.channelVolume[a]=b/127}
function Ta(c,a,b){var d=b-64,d=d/(0>d?64:63);c.table&&(c.table.querySelector("tbody > tr:nth-child("+(a+1)+") > td:nth-child(3)").textContent=b);c.channelPanpot[a]=d}La.prototype.pitchBend=function(c,a,b){var d,e,g,f=this.currentNoteOn[c];d=(a&127|(b&127)<<7)-8192;this.table&&(this.table.querySelector("tbody > tr:nth-child("+(c+1)+") > td:nth-child(4)").textContent=d);e=0;for(g=f.length;e<g;++e)ia(f[e],d);this.channelPitchBend[c]=d};
La.prototype.pitchBendSensitivity=function(c,a){this.table&&(this.table.querySelector("tbody > tr:nth-child("+(c+1)+") > td:nth-child(5)").textContent=a);this.channelPitchBendSensitivity[c]=a};function Ua(){this.RpnMsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.RpnLsb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];window.addEventListener("DOMContentLoaded",function(){this.ready=aa}.bind(this),t)}Ua.prototype.setup=function(c){this.ready?this.load(c):window.addEventListener("DOMContentLoaded",function b(){window.removeEventListener("DOMContentLoaded",b,t);this.load(c)}.bind(this),t)};
Ua.prototype.load=function(c){var a=new XMLHttpRequest;a.open("GET",c,aa);a.responseType="arraybuffer";a.addEventListener("load",function(a){var c=a.target;this.onload(c.response);"function"===typeof this.loadCallback&&this.loadCallback(c.response)}.bind(this),t);a.send()};
Ua.prototype.onload=function(c){var a,b,d,e,g=new Uint8Array(c),f=this.synth=new La(g),k=Pa(f),s;f.parser=new Ea(f.input);var p=f.parser;p.parse();var x=p.presetHeader,A=p.presetZone,I=[],O,J,P,ja,B,v,w,W;B=0;for(v=x.length;B<v;++B){O=x[B].presetBagIndex;J=x[B+1]?x[B+1].presetBagIndex:A.length;P=[];w=O;for(W=J;w<W;++w){var ka=Ka(A[w].presetGeneratorIndex,A[w+1]?A[w+1].presetGeneratorIndex:p.presetZoneGenerator.length,p.presetZoneGenerator);d=ka.modgen;e=ka.modgenInfo;var X=Ka(A[w].presetModulatorIndex,
A[w+1]?A[w+1].presetModulatorIndex:p.presetZoneModulator.length,p.presetZoneModulator);a=X.modgen;b=X.modgenInfo;P.push({generator:d,generatorSequence:e,modulator:a,modulatorSequence:b});ja=d.instrument!==r?d.instrument.amount:a.instrument!==r?a.instrument.amount:ba}I.push({name:x[B].presetName,info:P,header:x[B],instrument:ja})}var u,q,va,wa,F=p.instrument,D=p.instrumentZone,Y=[],xa,ya,ca,G,Z,C,Q;G=0;for(Z=F.length;G<Z;++G){xa=F[G].instrumentBagIndex;ya=F[G+1]?F[G+1].instrumentBagIndex:D.length;
ca=[];C=xa;for(Q=ya;C<Q;++C){var za=Ka(D[C].instrumentGeneratorIndex,D[C+1]?D[C+1].instrumentGeneratorIndex:p.instrumentZoneGenerator.length,p.instrumentZoneGenerator);va=za.modgen;wa=za.modgenInfo;var Aa=Ka(D[C].presetModulatorIndex,D[C+1]?D[C+1].instrumentModulatorIndex:p.instrumentZoneModulator.length,p.instrumentZoneModulator);u=Aa.modgen;q=Aa.modgenInfo;ca.push({generator:va,generatorSequence:wa,modulator:u,modulatorSequence:q})}Y.push({name:F[G].instrumentName,info:ca})}var K=[],R,z,la,ma,$,
na,L,m;$=0;for(na=I.length;$<na;++$)if(z=I[$],ma=z.header.preset,"number"===typeof z.instrument&&(la=Y[z.instrument],"EOI"!==la.name.replace(/\0*$/,""))){K[z.header.bank]===r&&(K[z.header.bank]=[]);R=K[z.header.bank];R[ma]=[];R[ma].name=z.name;L=0;for(m=la.info.length;L<m;++L){var l=p,Ba=R[ma],n=la.info[L].generator,oa=r,S=r,da=r,pa=r,T=r,U=r,V=r,qa=r,ra=r,sa=r,ta=r,ea=r,M=r,N=r,fa=r;if(!(n.keyRange===r||n.sampleID===r)){da=H(n,"attackVolEnv",-12E3);pa=H(n,"decayVolEnv",-12E3);T=H(n,"sustainVolEnv");
U=H(n,"releaseVolEnv",-12E3);V=H(n,"attackModEnv",-12E3);qa=H(n,"decayModEnv",-12E3);ra=H(n,"sustainModEnv");sa=H(n,"releaseModEnv",-12E3);ta=H(n,"coarseTune")+H(n,"fineTune")/100;ea=H(n,"scaleTuning",100)/100;M=H(n,"freqVibLFO");N=n.keyRange.lo;for(fa=n.keyRange.hi;N<=fa;++N)Ba[N]||(oa=H(n,"sampleID"),S=l.sampleHeader[oa],Ba[N]={sample:l.sample[oa],sampleRate:S.sampleRate,basePlaybackRate:Math.pow(Math.pow(2,1/12),(N-H(n,"overridingRootKey",S.originalPitch)+ta+S.pitchCorrection/100)*ea),modEnvToPitch:H(n,
"modEnvToPitch")/100,scaleTuning:ea,start:32768*H(n,"startAddrsCoarseOffset")+H(n,"startAddrsOffset"),end:32768*H(n,"endAddrsCoarseOffset")+H(n,"endAddrsOffset"),loopStart:S.startLoop+32768*H(n,"startloopAddrsCoarseOffset")+H(n,"startloopAddrsOffset"),loopEnd:S.endLoop+32768*H(n,"endloopAddrsCoarseOffset")+H(n,"endloopAddrsOffset"),volAttack:Math.pow(2,da/1200),volDecay:Math.pow(2,pa/1200),volSustain:T/1E3,volRelease:Math.pow(2,U/1200),modAttack:Math.pow(2,V/1200),modDecay:Math.pow(2,qa/1200),modSustain:ra/
1E3,modRelease:Math.pow(2,sa/1200),freqVibLFO:M?8.176*Math.pow(2,M/1200):r})}}}f.bankSet=K;for(s=0;16>s;++s)Ra(f,s,s),Sa(f,s,100),Ta(f,s,64),f.pitchBend(s,0,64),f.pitchBendSensitivity(s,2);f.start();document.body.appendChild(k);window.addEventListener("message",this.onmessage.bind(this),t);window.opener?window.opener.postMessage("link,ready","*"):window.parent!==window&&window.parent.postMessage("link,ready","*")};
Ua.prototype.onmessage=function(c){var a=c.data.split(","),b;switch(a.shift()){case "midi":Va(this,a.map(function(a){return parseInt(a,16)}));break;case "link":b=a.shift();switch(b){case "reqpatch":window.opener?window.opener.postMessage("link,patch","*"):window.parent!==window&&window.parent.postMessage("link,patch","*");break;case "setpatch":break;default:y.console.error("unknown link message:",b)}break;default:y.console.error("unknown message type")}};
Ua.prototype.setLoadCallback=function(c){this.loadCallback=c};
function Va(c,a){var b=a[0]&15,d=c.synth;switch(a[0]&240){case 128:d.noteOff(b,a[1],a[2]);break;case 144:0<a[2]?d.noteOn(b,a[1],a[2]):d.noteOff(b,a[1],0);break;case 176:switch(a[1]){case 6:switch(c.RpnMsb[b]){case 0:switch(c.RpnLsb[b]){case 0:d.pitchBendSensitivity(b,a[2])}}break;case 7:Sa(d,b,a[2]);break;case 10:Ta(d,b,a[2]);break;case 120:for(var e=d.currentNoteOn[b];0<e.length;)d.noteOff(b,e[0].key,0);break;case 121:d.pitchBend(b,0,64);break;case 100:c.RpnMsb[b]=a[2];break;case 101:c.RpnLsb[b]=
a[2]}break;case 192:Ra(d,b,a[1]);break;case 224:d.pitchBend(b,a[1],a[2]);break;case 240:switch(a[1]){case 127:switch(a[3]){case 4:switch(a[4]){case 1:var g=a[5]+(a[6]<<7);d.masterVolume=g;d.gainMaster.gain.value=d.baseVolume*(g/16384)}}}}};ga("SoundFont.WebMidiLink",Ua);ga("SoundFont.WebMidiLink.prototype.setup",Ua.prototype.setup);ga("SoundFont.WebMidiLink.prototype.setLoadCallback",Ua.prototype.setLoadCallback);}).call(this);
